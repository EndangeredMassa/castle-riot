module.exports = class InstructionsView
  constructor: (player) ->
    @backdrop = $("<div id='instructions-backdrop'></div>")
    @backdrop.click => @close()

    if player.isGuard
      @el = @guardInstructions()
      alreadySeen = localStorage.getItem "alreadySeenGuardInstructions"
      localStorage.setItem "alreadySeenGuardInstructions", true
    else
      @el = @thiefInstructions()
      alreadySeen = localStorage.getItem "alreadySeenThiefInstructions"
      localStorage.setItem "alreadySeenThiefInstructions", true

    @el.delegate "#start-playing", "click", (e) =>
      e.preventDefault()
      @close()

    $("#help-link").click (e) =>
      e.preventDefault()
      @open()

    nameField = @el.find("#name-field")
    nameField.val player.name
    nameField.change ->
      player.updateName nameField.val()

    @close()
    $("body").append @backdrop, @el

    unless alreadySeen
      $ => @open()

  guardInstructions: ->
    $ """
      <div id='guard-instructions' class='instructions'>
        <h1>Welcome to Castle Riot!</h1>
        <p>
          You are a <strong>Guard</strong>
          <span class="guard-image img"></span>
          Your goal is to catch the <strong>Thieves</strong>
          <span class="thief-image img"></span>
          that are stealing treasure from your castle!
        </p>
        <p>
          Thieves are sneaking around in the dark and will be invisible
          to you until you discover them with the <em>light
          of your torch.</em> Find 'em, chase 'em down and capture 'em
          by touching them to score <strong>1 point!</strong>
        </p>
        <p>
          Meanwhile, the thieves are trying to avoid you while stealing
          your treasures. Thieves only escape with the treasure and
          score points if they safely carry the treasure out a door.
        </p>
        <p class="images">
          <img src="/img/instructions/stealing.png" id="stealing-image" />
          <img src="/img/instructions/try-to-escape.png" id="try-to-escape-image" />
          <img src="/img/instructions/caught.png" id="caught-image" />
        </p>
        <p class="cta">
          <strong>Save Your Treasure!</strong>
          <a href="#" id="start-playing">Start Playing Now!</a>
        </p>
      </div>
    """


  thiefInstructions: ->
    $ """
      <div id='guard-instructions' class='instructions'>
        <h1>Welcome to Castle Riot!</h1>
        <p>
          You are a <strong>Thief</strong>
          <span class="thief-image img"></span>
          Your goal is to steal as much treasure
          as possible without letting the guards
          <span class="guard-image img"></span>
          catch you!
        </p>
        <p>
          Sneak around in the dark to find the castle's treasures,
          but be careful, the guards can find you using the <em>light
          of their torches.</em>
        </p>
        <p>
          Simply finding the treasure isn't enough, you still have to
          get it to a door before you <strong>score 1 point</strong>!
        </p>
        <p>
          Carrying treasure weighs you down and makes you slower than
          the guards, so press the "D" key to drop your treasure if you have
          to make a run for it!
        </p>
        <p class="images">
          <img src="/img/instructions/stealing.png" id="stealing-image" />
          <img src="/img/instructions/try-to-escape.png" id="try-to-escape-image" />
          <img src="/img/instructions/caught.png" id="caught-image" />
        </p>
        <p class="cta">
          <strong>Go Steal Some Treasure!</strong>
          <a href="#" id="start-playing">Start Playing Now!</a>
        </p>
      </div>
    """

  close: ->
    @backdrop.hide()
    @el.hide()

  open: ->
    @backdrop.show()
    @el.show()
