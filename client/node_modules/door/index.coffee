module.exports = class Door
  constructor: ({x, y}) ->
    # Doors seem to be off by 8 pixels, hence the offset below
    @sprite = new Sprite x: x - 8, y: y, scale: 1
    anim = new jaws.Animation
      sprite_sheet: "img/door.png"
      frame_size: [48, 32]
      frame_duration: 100
      orientation: 'down'
      loop: false
    @anim = anim.slice 0, 3
    @close()

  draw: -> @sprite.draw()
  rect: -> @sprite.rect()

  open: ->
    @anim.frame_direction = 1

  close: ->
    @anim.frame_direction = -1


  isOpen: ->
    @anim.frame_direction == 1

  openAndClose: ->
    @open()
    doClose = => @close()
    setTimeout doClose, 1000

  update: ->
    @sprite.setImage @anim.next()

  onTouchedByPlayer: (player) ->
    if !player.isGuard && player.painting
      return if @isOpen()
      @openAndClose()
      painting = player.painting
      player.dropPainting()
      painting.respawn()
      player.score.add 1
